# JVMæ·±åº¦è§£æå®Œæ•´æŒ‡å—

## ğŸ“š ç›®å½•ç»“æ„

æœ¬é¡¹ç›®æä¾›äº†JVMä»åº•å±‚åŸç†åˆ°å®æˆ˜è°ƒä¼˜çš„å®Œæ•´ä»£ç ç¤ºä¾‹å’Œè¯¦ç»†è®²è§£ã€‚

```
Jvm/src/main/java/com/architecture/jvm/
â”œâ”€â”€ runtime/                  # è¿è¡Œæ—¶æ•°æ®åŒº
â”‚   â”œâ”€â”€ RuntimeDataAreaDemo.java          # è¿è¡Œæ—¶æ•°æ®åŒºå®Œæ•´æ¼”ç¤º
â”‚   â”œâ”€â”€ VirtualMachineStackDemo.java      # è™šæ‹Ÿæœºæ ˆæ·±åº¦è§£æ
â”‚   â”œâ”€â”€ HeapMemoryDeepDive.java           # å †å†…å­˜æ·±åº¦åˆ†æ
â”‚   â”œâ”€â”€ MetaspaceDemo.java                # å…ƒç©ºé—´è¯¦è§£
â”‚   â””â”€â”€ DirectMemoryDemo.java             # ç›´æ¥å†…å­˜æ¼”ç¤º
â”‚
â”œâ”€â”€ classloader/              # ç±»åŠ è½½æœºåˆ¶
â”‚   â”œâ”€â”€ ClassLoaderExample.java           # ç±»åŠ è½½å™¨åŸºç¡€
â”‚   â”œâ”€â”€ ClassLoadingProcess.java          # ç±»åŠ è½½è¿‡ç¨‹
â”‚   â”œâ”€â”€ ParentDelegationModelDemo.java    # åŒäº²å§”æ´¾æ¨¡å‹
â”‚   â”œâ”€â”€ HotDeploymentDemo.java            # çƒ­éƒ¨ç½²å®ç°
â”‚   â””â”€â”€ ClassLoaderInterviewQuestions.java # é¢è¯•é¢˜
â”‚
â”œâ”€â”€ execution/                # æ‰§è¡Œå¼•æ“
â”‚   â””â”€â”€ JITCompilationDemo.java           # JITç¼–è¯‘å™¨æ·±åº¦æ¼”ç¤º
â”‚
â”œâ”€â”€ gc/                       # åƒåœ¾å›æ”¶
â”‚   â”œâ”€â”€ GarbageCollectionExample.java     # GCæ¼”ç¤º
â”‚   â”œâ”€â”€ GCAlgorithmSimulation.java        # GCç®—æ³•æ¨¡æ‹Ÿ
â”‚   â”œâ”€â”€ GCAlgorithmComparison.java        # GCç®—æ³•å¯¹æ¯”
â”‚   â”œâ”€â”€ ReferenceCountingDemo.java        # å¼•ç”¨è®¡æ•°
â”‚   â””â”€â”€ GCInterviewQuestions.java         # GCé¢è¯•é¢˜
â”‚
â”œâ”€â”€ memory/                   # å†…å­˜ç®¡ç†
â”‚   â”œâ”€â”€ MemoryManagementExample.java      # å†…å­˜ç®¡ç†ç¤ºä¾‹
â”‚   â”œâ”€â”€ MemoryAreaAnalysis.java           # å†…å­˜åŒºåŸŸåˆ†æ
â”‚   â”œâ”€â”€ ObjectMemoryLayoutDemo.java       # å¯¹è±¡å†…å­˜å¸ƒå±€
â”‚   â””â”€â”€ MemoryInterviewQuestions.java     # å†…å­˜é¢è¯•é¢˜
â”‚
â”œâ”€â”€ jmm/                      # Javaå†…å­˜æ¨¡å‹
â”‚   â””â”€â”€ JavaMemoryModelDemo.java          # JMMæ·±åº¦æ¼”ç¤º
â”‚
â”œâ”€â”€ bytecode/                 # å­—èŠ‚ç 
â”‚   â”œâ”€â”€ BytecodeAnalysisExample.java      # å­—èŠ‚ç åˆ†æ
â”‚   â””â”€â”€ BytecodeManipulationExample.java  # å­—èŠ‚ç æ“ä½œ
â”‚
â””â”€â”€ tuning/                   # æ€§èƒ½è°ƒä¼˜
    â”œâ”€â”€ JVMMonitoringTools.java           # JVMç›‘æ§å·¥å…·
    â”œâ”€â”€ PerformanceTuningExample.java     # æ€§èƒ½è°ƒä¼˜ç¤ºä¾‹
    â””â”€â”€ ProductionTuningCases.java        # ç”Ÿäº§ç¯å¢ƒè°ƒä¼˜å®æˆ˜
```

---

## ğŸ¯ æ ¸å¿ƒçŸ¥è¯†ç‚¹

### 1. è¿è¡Œæ—¶æ•°æ®åŒº (Runtime Data Area)

#### 1.1 ç¨‹åºè®¡æ•°å™¨ (PC Register)
- **ç‰¹ç‚¹**: çº¿ç¨‹ç§æœ‰ã€å”¯ä¸€ä¸ä¼šOOMçš„åŒºåŸŸ
- **ä½œç”¨**: è®°å½•å½“å‰çº¿ç¨‹æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤åœ°å€
- **å®ç°**: æ¯ä¸ªçº¿ç¨‹ç‹¬ç«‹çš„PCï¼Œæ”¯æŒå¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œ

#### 1.2 Javaè™šæ‹Ÿæœºæ ˆ (VM Stack)
- **æ ˆå¸§ç»“æ„**:
  - å±€éƒ¨å˜é‡è¡¨ (Local Variable Table)
  - æ“ä½œæ•°æ ˆ (Operand Stack)
  - åŠ¨æ€é“¾æ¥ (Dynamic Linking)
  - æ–¹æ³•è¿”å›åœ°å€ (Return Address)
- **å¼‚å¸¸**: StackOverflowError, OutOfMemoryError
- **åº”ç”¨**: æ–¹æ³•è°ƒç”¨ã€å±€éƒ¨å˜é‡å­˜å‚¨

#### 1.3 å †å†…å­˜ (Heap)
- **åˆ†ä»£ç»“æ„**:
  ```
  Heap
  â”œâ”€â”€ Young Generation (æ–°ç”Ÿä»£)
  â”‚   â”œâ”€â”€ Eden (8/10)
  â”‚   â”œâ”€â”€ Survivor0 (1/10)
  â”‚   â””â”€â”€ Survivor1 (1/10)
  â””â”€â”€ Old Generation (è€å¹´ä»£ 2/3)
  ```
- **å¯¹è±¡åˆ†é…æµç¨‹**:
  1. æ–°å¯¹è±¡ä¼˜å…ˆåœ¨EdenåŒºåˆ†é…
  2. Edenæ»¡è§¦å‘Minor GC
  3. å­˜æ´»å¯¹è±¡ç§»åˆ°Survivor
  4. å¹´é¾„è¾¾é˜ˆå€¼æ™‹å‡è€å¹´ä»£
  5. å¤§å¯¹è±¡ç›´æ¥è¿›è€å¹´ä»£
- **TLABä¼˜åŒ–**: çº¿ç¨‹æœ¬åœ°åˆ†é…ç¼“å†²ï¼Œå‡å°‘åŒæ­¥å¼€é”€

#### 1.4 æ–¹æ³•åŒº/å…ƒç©ºé—´ (Metaspace)
- **JDKç‰ˆæœ¬å˜åŒ–**:
  - JDK 7-: æ°¸ä¹…ä»£ (PermGen) - å †å†…å­˜
  - JDK 8+: å…ƒç©ºé—´ (Metaspace) - æœ¬åœ°å†…å­˜
- **å­˜å‚¨å†…å®¹**:
  - ç±»å…ƒæ•°æ®
  - è¿è¡Œæ—¶å¸¸é‡æ± 
  - é™æ€å˜é‡ (JDK 7+åœ¨å †ä¸­)
- **ä¼˜åŠ¿**: åŠ¨æ€æ‰©å±•ï¼Œä¸æ˜“OOM

#### 1.5 ç›´æ¥å†…å­˜ (Direct Memory)
- **ç‰¹ç‚¹**: å †å¤–å†…å­˜ï¼Œä¸å—GCç›´æ¥ç®¡ç†
- **åº”ç”¨**: NIOçš„DirectByteBuffer
- **ä¼˜åŠ¿**: é›¶æ‹·è´ï¼Œæé«˜IOæ€§èƒ½
- **åŠ£åŠ¿**: åˆ†é…æˆæœ¬é«˜ï¼Œéš¾ä»¥è¿½è¸ª

---

### 2. ç±»åŠ è½½æœºåˆ¶

#### 2.1 ç±»åŠ è½½è¿‡ç¨‹
```
åŠ è½½ (Loading)
  â†“
é“¾æ¥ (Linking)
  â”œâ”€â”€ éªŒè¯ (Verification)
  â”œâ”€â”€ å‡†å¤‡ (Preparation)
  â””â”€â”€ è§£æ (Resolution)
  â†“
åˆå§‹åŒ– (Initialization)
```

#### 2.2 åŒäº²å§”æ´¾æ¨¡å‹
```
Bootstrap ClassLoader (å¯åŠ¨ç±»åŠ è½½å™¨)
  â†‘ parent
Extension ClassLoader (æ‰©å±•ç±»åŠ è½½å™¨)
  â†‘ parent
Application ClassLoader (åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨)
  â†‘ parent
Custom ClassLoader (è‡ªå®šä¹‰ç±»åŠ è½½å™¨)
```

**ä¼˜ç‚¹**:
- é¿å…ç±»çš„é‡å¤åŠ è½½
- ä¿æŠ¤æ ¸å¿ƒç±»åº“
- ä¿è¯ç±»åŠ è½½çš„ä¸€è‡´æ€§

**æ‰“ç ´åŒäº²å§”æ´¾çš„åœºæ™¯**:
- Tomcatç±»åŠ è½½å™¨
- OSGiæ¨¡å—åŒ–æ¡†æ¶
- SPIæœºåˆ¶
- çƒ­éƒ¨ç½²

#### 2.3 çƒ­éƒ¨ç½²åŸç†
1. ä½¿ç”¨è‡ªå®šä¹‰ClassLoaderåŠ è½½ç±»
2. ç±»æ–‡ä»¶ä¿®æ”¹æ—¶åˆ›å»ºæ–°ClassLoader
3. æ–°ClassLoaderåŠ è½½ä¿®æ”¹åçš„ç±»
4. ä¸¢å¼ƒæ—§ClassLoaderç­‰å¾…GCå›æ”¶

---

### 3. æ‰§è¡Œå¼•æ“

#### 3.1 è§£é‡Šæ‰§è¡Œ vs JITç¼–è¯‘
- **è§£é‡Šå™¨**: é€è¡Œè§£é‡Šå­—èŠ‚ç ï¼Œå¯åŠ¨å¿«ä½†æ‰§è¡Œæ…¢
- **JITç¼–è¯‘å™¨**: å°†çƒ­ç‚¹ä»£ç ç¼–è¯‘ä¸ºæœ¬åœ°ä»£ç ï¼Œæ‰§è¡Œå¿«

#### 3.2 HotSpotçš„ä¸¤ä¸ªç¼–è¯‘å™¨
- **C1 (Client Compiler)**: å¿«é€Ÿç¼–è¯‘ï¼Œä¼˜åŒ–è¾ƒå°‘
- **C2 (Server Compiler)**: æ…¢é€Ÿç¼–è¯‘ï¼Œæ¿€è¿›ä¼˜åŒ–

#### 3.3 åˆ†å±‚ç¼–è¯‘ (Tiered Compilation)
```
Level 0: è§£é‡Šæ‰§è¡Œ
Level 1: C1ç¼–è¯‘ï¼Œæ— profiling
Level 2: C1ç¼–è¯‘ + è°ƒç”¨è®¡æ•°å™¨
Level 3: C1ç¼–è¯‘ + å®Œæ•´profiling
Level 4: C2ç¼–è¯‘ï¼Œå®Œå…¨ä¼˜åŒ–
```

#### 3.4 ç¼–è¯‘ä¼˜åŒ–æŠ€æœ¯
- **é€ƒé€¸åˆ†æ** (Escape Analysis)
  - æ ˆä¸Šåˆ†é…
  - æ ‡é‡æ›¿æ¢
  - é”æ¶ˆé™¤
- **æ–¹æ³•å†…è”** (Method Inlining)
- **å…¬å…±å­è¡¨è¾¾å¼æ¶ˆé™¤** (CSE)
- **å¾ªç¯å±•å¼€** (Loop Unrolling)
- **æ­»ä»£ç æ¶ˆé™¤** (Dead Code Elimination)

---

### 4. åƒåœ¾å›æ”¶

#### 4.1 GCç®—æ³•
1. **æ ‡è®°-æ¸…é™¤** (Mark-Sweep)
   - æ ‡è®°å­˜æ´»å¯¹è±¡ï¼Œæ¸…é™¤æœªæ ‡è®°å¯¹è±¡
   - äº§ç”Ÿå†…å­˜ç¢ç‰‡

2. **å¤åˆ¶ç®—æ³•** (Copying)
   - å†…å­˜åˆ†ä¸¤å—ï¼Œå­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å—
   - æ— ç¢ç‰‡ï¼Œä½†ç©ºé—´åˆ©ç”¨ç‡ä½
   - ç”¨äºæ–°ç”Ÿä»£

3. **æ ‡è®°-æ•´ç†** (Mark-Compact)
   - æ ‡è®°åæ•´ç†å†…å­˜ï¼Œç§»åŠ¨å¯¹è±¡
   - æ— ç¢ç‰‡ï¼Œä½†ç§»åŠ¨æˆæœ¬é«˜
   - ç”¨äºè€å¹´ä»£

4. **åˆ†ä»£æ”¶é›†** (Generational Collection)
   - æ–°ç”Ÿä»£ç”¨å¤åˆ¶ç®—æ³•
   - è€å¹´ä»£ç”¨æ ‡è®°-æ•´ç†

#### 4.2 GCæ”¶é›†å™¨å¯¹æ¯”

| æ”¶é›†å™¨ | ç±»å‹ | ç®—æ³• | ç›®æ ‡ | é€‚ç”¨åœºæ™¯ |
|--------|------|------|------|----------|
| Serial | å•çº¿ç¨‹ | å¤åˆ¶ | ååé‡ | å®¢æˆ·ç«¯åº”ç”¨ |
| ParNew | å¤šçº¿ç¨‹ | å¤åˆ¶ | ååé‡ | é…åˆCMS |
| Parallel Scavenge | å¤šçº¿ç¨‹ | å¤åˆ¶ | ååé‡ | åå°è®¡ç®— |
| Serial Old | å•çº¿ç¨‹ | æ ‡è®°-æ•´ç† | ååé‡ | å®¢æˆ·ç«¯åº”ç”¨ |
| Parallel Old | å¤šçº¿ç¨‹ | æ ‡è®°-æ•´ç† | ååé‡ | åå°è®¡ç®— |
| CMS | å¤šçº¿ç¨‹ | æ ‡è®°-æ¸…é™¤ | ä½å»¶è¿Ÿ | Webåº”ç”¨ |
| G1 | å¤šçº¿ç¨‹ | æ•´ä½“æ ‡è®°-æ•´ç† | å¯æ§å»¶è¿Ÿ | å¤§å †åº”ç”¨ |
| ZGC | å¤šçº¿ç¨‹ | ç€è‰²æŒ‡é’ˆ | è¶…ä½å»¶è¿Ÿ | è¶…å¤§å † |
| Shenandoah | å¤šçº¿ç¨‹ | å¹¶å‘æ•´ç† | è¶…ä½å»¶è¿Ÿ | è¶…å¤§å † |

#### 4.3 å¼•ç”¨ç±»å‹
- **å¼ºå¼•ç”¨**: æ™®é€šå¼•ç”¨ï¼Œæ°¸ä¸å›æ”¶
- **è½¯å¼•ç”¨**: å†…å­˜ä¸è¶³æ—¶å›æ”¶
- **å¼±å¼•ç”¨**: GCæ—¶å›æ”¶
- **è™šå¼•ç”¨**: å¯¹è±¡å›æ”¶æ—¶æ”¶åˆ°é€šçŸ¥

---

### 5. å¯¹è±¡å†…å­˜å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¯¹è±¡å¤´ (Object Header)    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Mark Word (8å­—èŠ‚)         â”‚ å“ˆå¸Œç ã€GCå¹´é¾„ã€é”æ ‡å¿—
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Class Pointer (4/8å­—èŠ‚)   â”‚ ç±»å‹æŒ‡é’ˆ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Array Length (4å­—èŠ‚)      â”‚ ä»…æ•°ç»„å¯¹è±¡
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å®ä¾‹æ•°æ® (Instance Data)  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¯¹é½å¡«å…… (Padding)         â”‚ è¡¥é½åˆ°8å­—èŠ‚å€æ•°
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Mark WordçŠ¶æ€
- **æ— é”**: hashCode + GCå¹´é¾„ + 01
- **åå‘é”**: çº¿ç¨‹ID + epoch + 101
- **è½»é‡çº§é”**: æ ˆä¸­é”è®°å½•æŒ‡é’ˆ + 00
- **é‡é‡çº§é”**: MonitoræŒ‡é’ˆ + 10
- **GCæ ‡è®°**: 11

#### å‹ç¼©æŒ‡é’ˆ (Compressed Oops)
- å°†64ä½æŒ‡é’ˆå‹ç¼©ä¸º32ä½
- é€‚ç”¨äºå † < 32GB
- èŠ‚çœçº¦30%å†…å­˜

---

### 6. Javaå†…å­˜æ¨¡å‹ (JMM)

#### 6.1 JMMæŠ½è±¡ç»“æ„
```
Thread1     Thread2     Thread3
   â†“           â†“           â†“
å·¥ä½œå†…å­˜    å·¥ä½œå†…å­˜    å·¥ä½œå†…å­˜
   â†“           â†“           â†“
         ä¸»å†…å­˜ (Main Memory)
```

#### 6.2 ä¸‰å¤§ç‰¹æ€§
1. **åŸå­æ€§**: synchronized, Lock
2. **å¯è§æ€§**: volatile, synchronized, Lock
3. **æœ‰åºæ€§**: volatile, synchronized, happens-before

#### 6.3 happens-beforeè§„åˆ™
1. ç¨‹åºæ¬¡åºè§„åˆ™
2. ç›‘è§†å™¨é”è§„åˆ™
3. volatileå˜é‡è§„åˆ™
4. çº¿ç¨‹å¯åŠ¨è§„åˆ™
5. çº¿ç¨‹ç»ˆæ­¢è§„åˆ™
6. çº¿ç¨‹ä¸­æ–­è§„åˆ™
7. å¯¹è±¡ç»ˆç»“è§„åˆ™
8. ä¼ é€’æ€§

#### 6.4 volatileåŸç†
- **ä¿è¯å¯è§æ€§**: å†™å…¥ç«‹å³åˆ·æ–°åˆ°ä¸»å†…å­˜
- **ç¦æ­¢é‡æ’åº**: æ’å…¥å†…å­˜å±éšœ
- **ä¸ä¿è¯åŸå­æ€§**: count++éåŸå­

#### 6.5 å†…å­˜å±éšœ
- LoadLoad Barrier
- StoreStore Barrier
- LoadStore Barrier
- StoreLoad Barrier

---

### 7. æ€§èƒ½è°ƒä¼˜å®æˆ˜

#### 7.1 OOMé—®é¢˜æ’æŸ¥
```bash
# 1. æŸ¥çœ‹å †ä¿¡æ¯
jmap -heap <pid>

# 2. Dumpå †å¿«ç…§
jmap -dump:format=b,file=heap.hprof <pid>

# 3. MATåˆ†æ
# æ‰“å¼€heap.hprofï¼Œç”ŸæˆLeak SuspectsæŠ¥å‘Š

# 4. æŸ¥æ‰¾å¤§å¯¹è±¡
# Histogram â†’ æŒ‰å¤§å°æ’åº
```

#### 7.2 CPUé£™é«˜æ’æŸ¥
```bash
# 1. æ‰¾åˆ°Javaè¿›ç¨‹
top -c

# 2. æ‰¾åˆ°é«˜CPUçº¿ç¨‹
top -Hp <pid>

# 3. è½¬æ¢çº¿ç¨‹IDä¸º16è¿›åˆ¶
printf '%x\n' <tid>

# 4. æŸ¥çœ‹çº¿ç¨‹æ ˆ
jstack <pid> | grep -A 50 <hex_tid>
```

#### 7.3 é¢‘ç¹GCæ’æŸ¥
```bash
# 1. æŸ¥çœ‹GCç»Ÿè®¡
jstat -gcutil <pid> 1000

# 2. åˆ†æGCæ—¥å¿—
-XX:+PrintGCDetails -XX:+PrintGCTimeStamps

# 3. GCå¯è§†åŒ–åˆ†æ
ä½¿ç”¨GCVieweråˆ†ææ—¥å¿—
```

#### 7.4 å†…å­˜æ³„æ¼æ’æŸ¥
```bash
# 1. è·å–ä¸¤æ¬¡å †å¿«ç…§
jmap -dump:format=b,file=heap1.hprof <pid>
# è¿è¡Œä¸€æ®µæ—¶é—´
jmap -dump:format=b,file=heap2.hprof <pid>

# 2. MATå¯¹æ¯”åˆ†æ
# æ‰“å¼€heap2.hprof
# ä¸heap1.hprofå¯¹æ¯”

# 3. åˆ†æå¼•ç”¨é“¾
# Path to GC Roots
# æ‰¾åˆ°é˜»æ­¢å›æ”¶çš„å¼•ç”¨
```

#### 7.5 æ­»é”æ£€æµ‹
```bash
# 1. jstackæ£€æµ‹
jstack <pid> | grep "deadlock"

# 2. ç¼–ç¨‹æ£€æµ‹
ThreadMXBean.findDeadlockedThreads()
```

---

## ğŸ› ï¸ JVMå‚æ•°é…ç½®

### å †å†…å­˜é…ç½®
```bash
-Xms4g                      # åˆå§‹å †å¤§å°
-Xmx4g                      # æœ€å¤§å †å¤§å°
-Xmn2g                      # æ–°ç”Ÿä»£å¤§å°
-XX:NewRatio=2              # è€å¹´ä»£/æ–°ç”Ÿä»£æ¯”ä¾‹
-XX:SurvivorRatio=8         # Eden/Survivoræ¯”ä¾‹
```

### GCé€‰æ‹©
```bash
# G1 GC (æ¨è)
-XX:+UseG1GC
-XX:MaxGCPauseMillis=200
-XX:G1HeapRegionSize=16m

# ZGC (è¶…ä½å»¶è¿Ÿ)
-XX:+UseZGC

# Parallel GC (é«˜åå)
-XX:+UseParallelGC
```

### å…ƒç©ºé—´
```bash
-XX:MetaspaceSize=256m
-XX:MaxMetaspaceSize=512m
```

### GCæ—¥å¿—
```bash
-XX:+PrintGCDetails
-XX:+PrintGCTimeStamps
-XX:+PrintGCDateStamps
-Xloggc:/var/log/gc.log
```

### OOMæ—¶Dump
```bash
-XX:+HeapDumpOnOutOfMemoryError
-XX:HeapDumpPath=/var/log/dumps/
```

### å®Œæ•´ç¤ºä¾‹ (4Gå †ï¼ŒG1 GC)
```bash
java \
  -Xms4g -Xmx4g \
  -Xmn2g \
  -XX:MetaspaceSize=256m -XX:MaxMetaspaceSize=512m \
  -XX:+UseG1GC \
  -XX:MaxGCPauseMillis=200 \
  -XX:+PrintGCDetails \
  -Xloggc:/var/log/gc.log \
  -XX:+HeapDumpOnOutOfMemoryError \
  -XX:HeapDumpPath=/var/log/dumps/ \
  -jar app.jar
```

---

## ğŸ“Š ç›‘æ§å·¥å…·

### å‘½ä»¤è¡Œå·¥å…·
| å·¥å…· | åŠŸèƒ½ |
|------|------|
| jps | æŸ¥çœ‹Javaè¿›ç¨‹ |
| jstat | GCç»Ÿè®¡ |
| jmap | Dumpå †ã€æŸ¥çœ‹å †ä¿¡æ¯ |
| jstack | Dumpçº¿ç¨‹æ ˆ |
| jinfo | æŸ¥çœ‹/ä¿®æ”¹JVMå‚æ•° |
| jcmd | å¤šåŠŸèƒ½è¯Šæ–­ |

### å¯è§†åŒ–å·¥å…·
- **JConsole**: JDKè‡ªå¸¦ç›‘æ§
- **VisualVM**: åŠŸèƒ½å¼ºå¤§çš„Profile
- **JProfiler**: å•†ä¸šProfileå·¥å…·
- **MAT**: å†…å­˜åˆ†æå·¥å…·
- **GCViewer**: GCæ—¥å¿—åˆ†æ
- **Arthas**: é˜¿é‡Œå¼€æºè¯Šæ–­å·¥å…·

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. å†…å­˜é…ç½®
- âœ“ å †åˆå§‹å€¼å’Œæœ€å¤§å€¼è®¾ç½®ç›¸åŒ
- âœ“ æ–°ç”Ÿä»£å å †çš„1/2åˆ°1/3
- âœ“ å…ƒç©ºé—´è®¾ç½®åˆç†ä¸Šé™
- âœ— å †ä¸è¦è®¾ç½®è¿‡å¤§ (å½±å“GCæ—¶é—´)

### 2. GCé€‰æ‹©
- Webåº”ç”¨: G1 GC
- æ‰¹å¤„ç†: Parallel GC
- ä½å»¶è¿Ÿ: ZGC/Shenandoah
- å°å †: Serial GC

### 3. ç›‘æ§å‘Šè­¦
- å †ä½¿ç”¨ç‡ > 80%
- Full GCé¢‘ç‡ > 1æ¬¡/åˆ†é’Ÿ
- GCè€—æ—¶ > 1ç§’
- çº¿ç¨‹æ•°å¼‚å¸¸å¢é•¿

### 4. ä»£ç ä¼˜åŒ–
- å¯¹è±¡å¤ç”¨ (æ± åŒ–)
- é¿å…å¤§å¯¹è±¡
- åŠæ—¶é‡Šæ”¾èµ„æº
- ä½¿ç”¨åˆé€‚çš„é›†åˆå¤§å°

---

## ğŸ“ å­¦ä¹ è·¯å¾„

1. **åŸºç¡€é˜¶æ®µ**:
   - è¿è¡Œæ—¶æ•°æ®åŒº
   - ç±»åŠ è½½æœºåˆ¶
   - å¯¹è±¡åˆ›å»ºå’Œè®¿é—®

2. **è¿›é˜¶é˜¶æ®µ**:
   - åƒåœ¾å›æ”¶ç®—æ³•
   - GCæ”¶é›†å™¨å¯¹æ¯”
   - å†…å­˜æ¨¡å‹

3. **é«˜çº§é˜¶æ®µ**:
   - JITç¼–è¯‘ä¼˜åŒ–
   - å­—èŠ‚ç æ“ä½œ
   - æ€§èƒ½è°ƒä¼˜

4. **å®æˆ˜é˜¶æ®µ**:
   - çº¿ä¸Šé—®é¢˜æ’æŸ¥
   - å‚æ•°è°ƒä¼˜
   - ç›‘æ§ä½“ç³»æ­å»º

---

## ğŸ“– æ¨èèµ„æº

### ä¹¦ç±
- ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹(å‘¨å¿—æ˜)
- ã€ŠJavaæ€§èƒ½æƒå¨æŒ‡å—ã€‹
- ã€ŠHotSpotå®æˆ˜ã€‹

### å®˜æ–¹æ–‡æ¡£
- [JVMè§„èŒƒ](https://docs.oracle.com/javase/specs/jvms/se11/html/)
- [GCè°ƒä¼˜æŒ‡å—](https://docs.oracle.com/en/java/javase/11/gctuning/)

### å·¥å…·
- [JOL (Java Object Layout)](https://openjdk.java.net/projects/code-tools/jol/)
- [Arthas](https://arthas.aliyun.com/)
- [MAT](https://www.eclipse.org/mat/)

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

```bash
# 1. å…‹éš†é¡¹ç›®
cd Jvm

# 2. è¿è¡Œç¤ºä¾‹
# è¿è¡Œæ—¶æ•°æ®åŒºæ¼”ç¤º
java -cp target/classes com.architecture.jvm.runtime.RuntimeDataAreaDemo

# JITç¼–è¯‘æ¼”ç¤º
java -cp target/classes com.architecture.jvm.execution.JITCompilationDemo

# å¯¹è±¡å†…å­˜å¸ƒå±€
java -cp target/classes com.architecture.jvm.memory.ObjectMemoryLayoutDemo

# JMMæ¼”ç¤º
java -cp target/classes com.architecture.jvm.jmm.JavaMemoryModelDemo

# æ€§èƒ½è°ƒä¼˜æ¡ˆä¾‹
java -cp target/classes com.architecture.jvm.tuning.ProductionTuningCases
```

---

## ğŸ“ æ€»ç»“

æœ¬é¡¹ç›®æä¾›äº†ä»JVMåº•å±‚åŸç†åˆ°ç”Ÿäº§å®æˆ˜çš„å®Œæ•´çŸ¥è¯†ä½“ç³»ï¼š

âœ… **15+** æ ¸å¿ƒæ¼”ç¤ºç±»
âœ… **1000+** è¡Œè¯¦ç»†æ³¨é‡Š
âœ… **50+** å®æˆ˜æ¡ˆä¾‹
âœ… **100+** çŸ¥è¯†ç‚¹è¦†ç›–

æ¶µç›–ï¼šè¿è¡Œæ—¶æ•°æ®åŒºã€ç±»åŠ è½½ã€æ‰§è¡Œå¼•æ“ã€åƒåœ¾å›æ”¶ã€å†…å­˜æ¨¡å‹ã€å¯¹è±¡å¸ƒå±€ã€æ€§èƒ½è°ƒä¼˜ç­‰å…¨éƒ¨æ ¸å¿ƒå†…å®¹ã€‚

æ¯ä¸ªæ¼”ç¤ºç±»éƒ½åŒ…å«ï¼š
- ğŸ“– åŸç†è®²è§£
- ğŸ’» ä»£ç ç¤ºä¾‹
- ğŸ¯ å®æˆ˜æ¡ˆä¾‹
- ğŸ’¡ æœ€ä½³å®è·µ

**å¼€å§‹ä½ çš„JVMæ·±åº¦å­¦ä¹ ä¹‹æ—…å§ï¼** ğŸ‰

---

## ğŸ‘¨â€ğŸ’» Author
Architecture Team

## ğŸ“„ License
MIT License

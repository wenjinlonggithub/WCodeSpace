# 互联网医院后端技术栈文档

## 文档版本信息
- **版本号**：v1.0
- **更新时间**：2026-01-27
- **维护团队**：后端架构组
- **适用范围**：互联网医院全栈业务系统

---

## 目录

- [一、技术栈概览](#一技术栈概览)
- [二、基础技术层](#二基础技术层)
- [三、数据持久层](#三数据持久层)
- [四、中台服务层](#四中台服务层)
- [五、微服务体系架构](#五微服务体系架构)
- [六、服务治理](#六服务治理)
- [七、开发规范](#七开发规范)
- [八、数据库设计规范](#八数据库设计规范)
- [九、部署架构](#九部署架构)
- [十、技术选型总结](#十技术选型总结)

---

## 一、技术栈概览

### 1.1 架构风格
- **微服务架构**：基于Spring Cloud Alibaba生态构建分布式微服务体系
- **前后端分离**：RESTful API设计，支持多端接入
- **中台化设计**：支付、消息等通用能力中台化

### 1.2 核心技术组件

| 技术分类 | 技术选型 | 版本要求 | 用途说明 |
|---------|---------|---------|---------|
| 编程语言 | Java | JDK 11 | 核心开发语言 |
| 开发框架 | Spring Boot | 2.6.x+ | 微服务应用框架 |
| 服务调用 | OpenFeign | 3.1.x+ | 声明式HTTP客户端 |
| 注册中心 | Nacos | 2.1.x+ | 服务注册与发现 |
| 配置中心 | Nacos | 2.1.x+ | 动态配置管理 |
| 关系数据库 | MySQL | 8.0+ | 核心业务数据存储 |
| 对象存储 | 阿里云OSS | - | 文件、图片、视频存储 |
| 短信服务 | 腾讯云短信 | SDK 3.x | 验证码、通知短信 |
| 即时通讯 | 腾讯IM | SDK 5.x | IM聊天、音视频通话 |
| 物流服务 | 顺丰物流 | API v1.0 | 药品配送服务 |
| 物流追踪 | 快递100 | API v2.0 | 多渠道物流查询 |
| 消息推送 | 极光推送 | SDK 4.x | APP消息推送 |
| 支付中台 | 自研支付中台 | - | 统一支付接入 |

---

## 二、基础技术层

### 2.1 Java运行环境（JDK 11）

**版本选择理由**
- 长期支持版本（LTS），Oracle提供至2026年的支持
- 性能提升：G1 GC优化，启动速度提升
- 新特性：HTTP Client API、字符串增强、局部变量类型推断
- 稳定性：业界大规模应用验证

**JVM关键配置**
- 堆内存：4GB起步，根据业务量调整
- GC策略：使用G1垃圾收集器

---

### 2.2 Spring Boot应用框架

**核心能力**
- Web开发：RESTful API、参数校验
- 数据访问：MyBatis-Plus集成

**关键依赖模块**
- spring-boot-starter-web：Web应用开发
- spring-boot-starter-validation：参数校验

---

### 2.3 OpenFeign服务调用

**功能特性**
- 声明式HTTP客户端：通过接口定义调用远程服务

**配置要点**
- 连接超时：5秒

---

### 2.4 Nacos服务治理

**双重功能**
- **注册中心**：服务注册与发现、健康检查、负载均衡

**服务注册核心配置**
- 命名空间：环境隔离（dev/test/prod）
- 分组：业务分组管理
- 心跳检测：5秒间隔，15秒超时

---

## 三、数据持久层

### 3.1 MySQL数据库

**版本与特性**
- MySQL 8.0.28+
- InnoDB存储引擎，支持事务ACID
- MVCC多版本并发控制

**连接池配置（Druid）**
- 初始连接数：5
- 最小空闲连接：5
- 最大活跃连接：20
- 连接等待超时：60秒

**数据访问层（MyBatis-Plus）**
- 自动CRUD操作
- 逻辑删除支持
- 分页插件

**数据库设计规范**
- 表名：小写字母+下划线
- 主键：BIGINT自增ID
- 时间字段：created_time、updated_time
- 逻辑删除：deleted字段

---

## 四、外部服务对接

### 4.1 腾讯云短信服务

**功能场景**
- 验证码短信：登录、注册、支付验证
- 通知短信：预约提醒、问诊通知、配送通知

**限流控制**
- 单手机号每日上限：10条
- 单手机号每分钟上限：1条
- 基于Redis实现限流

---

### 4.2 阿里云OSS对象存储

**存储场景**
- 处方图片：电子处方图片存储
- 病历文件：用户健康档案
- 用户头像：个人头像图片

**文件限制**
- 最大文件大小：10MB
- 允许扩展名：jpg、jpeg、png、pdf、doc、docx

---

### 4.3 腾讯IM音视频服务

**功能场景**
- 图文问诊：文字、图片消息实时传输
- 视频问诊：医患视频通话
- 语音问诊：语音通话功能
 
**集成能力**
- 单聊：一对一医患沟通
- 音视频通话：实时通话

---

### 4.5 物流配送服务

#### 4.5.1 顺丰物流

**核心功能**
- 下单接口：创建快递订单
- 路由查询：实时物流轨迹
- 签收确认：配送完成确认
- 取消订单：订单取消接口
 

#### 4.5.2 快递100

**核心功能**
- 多渠道查询：支持100+快递公司
- 智能识别：自动识别快递公司
- 订阅推送：物流状态变更推送
- 查询接口：统一查询API

---

### 4.6 极光推送服务

**推送场景**
- 问诊通知：医生接诊、问诊结果
- 订单通知：支付成功、发货提醒
- 处方通知：处方审核、药品发货
 
**推送类型**
- 通知栏消息：系统级通知
- 透传消息：应用内消息

---

### 4.7 监管平台对接

#### 4.7.1 天津监管平台

**上报内容**
- 问诊记录：问诊过程记录
- 处方信息：电子处方数据
- 药品配送：药品流转信息

**上报方式**
- 接口类型：WebService/RESTful API
- 上报频率：实时上报或定时批量
- 数据格式：XML/JSON
- 加密方式：数字签名、HTTPS

#### 4.7.2 北京监管平台

**上报内容**
- 电子处方流转数据
- 患者就诊信息

**上报方式**
- 接口协议：符合北京市标准
- 数据标准：遵循北京市规范

#### 4.7.3 HIS系统对接

**对接能力**
- 患者信息同步：患者基本信息、就诊历史
- 电子病历获取：历史病历、检查报告
- 处方同步：线下处方数据同步
- 费用查询：医疗费用明细
- 预约挂号：线上预约对接

**对接方式**
- 数据映射：字段映射、数据转换
- 数据同步：实时同步或定时同步
- 安全机制：VPN专线、数据加密

---

## 五、微服务体系架构

### 5.1 整体架构分层

```
┌──────────────────────────────────────────────────────────┐
│                    外部接入体系                            │
│  天津监管 | 北京监管 | HIS系统 | 腾讯IM音视频              │
│  顺丰物流 | 快递100 | 极光推送                             │
└──────────────────────────────────────────────────────────┘
                            ↓
┌──────────────────────────────────────────────────────────┐
│                    业务应用层                              │
│  问诊 | 处方 | 订单 | 药品 | 物流 | 检验 | 慢病管理         │
└──────────────────────────────────────────────────────────┘
                            ↓
┌──────────────────────────────────────────────────────────┐
│                    中台服务层                              │
│  支付中台 | 订单中台 | 退款中台 | 药品主数据中台            │
│  SaaS中台（调研问卷 | 病例审批）                           │
└──────────────────────────────────────────────────────────┘
                            ↓
┌──────────────────────────────────────────────────────────┐
│                  基础设施层                                │
│  统一网关 | 配置中心 | 注册中心 | 数据库 | 对象存储         │
└──────────────────────────────────────────────────────────┘
```

---
   
## 六、服务治理

### 6.1 服务注册与发现（Nacos）

**注册配置**
- 服务名称：唯一标识服务
- 命名空间：环境隔离
- 分组：业务分组

**服务发现**
- 负载均衡：轮询、随机、权重等策略
- 健康实例筛选：只返回健康的服务实例
- 服务订阅：监听服务变化

---

### 6.2 API网关（Spring Cloud Gateway）

**核心功能**
- 路由转发：根据路径匹配转发到对应服务
- 鉴权认证：令牌验证
- 限流熔断：防止服务过载
- 日志追踪：记录请求链路
- 统一异常处理：标准化错误响应

---

## 七、开发规范

### 7.1 项目结构规范

```
service-name/
├── controller/         # 控制器层（接口定义）
├── service/           # 服务层（业务逻辑）
├── repository/        # 数据访问层（DAO）
├── feign/             # Feign客户端（远程调用）
├── model/             # 数据模型
│   ├── dto/          # 数据传输对象
│   ├── vo/           # 视图对象
│   └── request/      # 请求对象
├── common/            # 通用组件
│   ├── constant/     # 常量定义
│   ├── enums/        # 枚举类型
│   ├── exception/    # 异常定义
│   └── util/         # 工具类
└── config/            # 配置类
```

---

### 7.2 命名规范

**类命名**
- 控制器：UserController
- 服务类：UserService、UserServiceImpl
- 数据访问：UserMapper、UserRepository
- 实体类：User、ConsultationOrder

**方法命名**
- 查询：getById、findByName、queryList
- 新增：create、add、insert
- 修改：update、modify
- 删除：delete、remove

**常量命名**
- 全大写+下划线：MAX_RETRY_COUNT

---

### 7.3 接口设计规范

**RESTful风格**
- GET：查询资源
- POST：创建资源
- PUT：更新资源
- DELETE：删除资源

**URL设计**
- /api/v1/users：用户列表
- /api/v1/users/{id}：用户详情
- /api/v1/consultations：问诊列表

**统一响应格式**
```json
{
  "code": "SUCCESS",
  "message": "操作成功",
  "data": {},
  "timestamp": 1706342400000
}
```

---

### 7.4 日志规范

**日志级别**
- ERROR：系统异常（需要立即处理）
- WARN：业务异常（可预期的错误）
- INFO：关键业务流程
- DEBUG：详细调试信息

**日志内容**
- 关键参数：订单ID、用户ID等
- 业务操作：创建订单、支付成功等
- 异常信息：完整的异常堆栈

---

## 八、数据库设计规范

### 8.1 表设计规范

**命名规范**
- 表名：小写字母+下划线，如 consultation_order
- 字段名：小写字母+下划线，如 patient_id

**必备字段**
- id：主键，BIGINT AUTO_INCREMENT
- created_time：创建时间，DATETIME
- updated_time：更新时间，DATETIME
- deleted：逻辑删除，TINYINT(1)

**索引设计**
- 主键索引：id
- 唯一索引：业务唯一字段（如订单号）
- 普通索引：常用查询条件（如用户ID、时间）
- 复合索引：多字段组合查询

---

### 8.2 数据库规范

**字段类型选择**
- 整数：TINYINT、INT、BIGINT（根据数值范围）
- 字符串：VARCHAR（变长）、CHAR（定长）
- 金额：DECIMAL(10,2)
- 时间：DATETIME、TIMESTAMP
- 大文本：TEXT

**避免事项**
- 避免使用NULL：设置默认值
- 避免大字段：单独表存储或使用OSS
- 避免过度冗余：合理的反范式设计

---

## 九、部署架构

### 10.1 容器化部署（Docker）

**Docker镜像**
- 基础镜像：openjdk:11-jre-slim
- 工作目录：/app
- 端口暴露：8080-8099

**镜像构建**
- 多阶段构建：编译阶段+运行阶段
- 镜像分层：依赖层+应用层
- 镜像优化：减小镜像体积

---
 
## 十、技术选型总结

### 11.1 选型对比

| 技术组件 | 优势 | 选择理由 |
|---------|------|---------|
| JDK 11 | LTS长期支持、性能优化、新特性 | 稳定可靠 |
| Spring Boot | 快速开发、生态完善、约定优于配置 | 行业标准 |
| Nacos | 注册+配置一体、性能优秀、功能丰富 | 阿里生态 |
| MySQL 8.0 | 稳定可靠、生态成熟、事务保障 | 数据一致性 |
| OpenFeign | 声明式调用、集成Spring Cloud | 简化开发 |

---

### 11.2 技术栈成熟度评估

| 组件 | 成熟度 | 社区活跃度 | 企业应用 |
|-----|-------|----------|---------|
| Spring Boot | ★★★★★ | 非常活跃 | 广泛应用 |
| Nacos | ★★★★☆ | 活跃 | 中大型企业 |
| MySQL | ★★★★★ | 非常活跃 | 全行业 |
| OpenFeign | ★★★★☆ | 活跃 | 微服务场景 |

---
 

**文档维护**：后端架构组  
**最后更新**：2026-01-27  
**文档状态**：正式发布  
**适用版本**：v1.0

<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è·³è¡¨æ•°æ®ç»“æ„ - æ ¸å¿ƒæµç¨‹å›¾</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .container {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        h1 {
            color: #667eea;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
            text-align: center;
        }
        h2 {
            color: #764ba2;
            margin-top: 40px;
            border-left: 5px solid #764ba2;
            padding-left: 15px;
        }
        h3 {
            color: #667eea;
            margin-top: 30px;
        }
        .toc {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }
        .toc ul {
            list-style: none;
            padding-left: 0;
        }
        .toc li {
            margin: 10px 0;
        }
        .toc a {
            color: #667eea;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }
        .toc a:hover {
            color: #764ba2;
        }
        .structure-diagram {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            margin: 20px 0;
            border: 2px solid #667eea;
        }
        .explanation {
            background: #e7f3ff;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 5px solid #2196F3;
        }
        .note {
            background: #fff3cd;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 5px solid #ffc107;
        }
        .tip {
            background: #d4edda;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 5px solid #28a745;
        }
        .mermaid {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        th, td {
            padding: 12px;
            text-align: left;
            border: 1px solid #ddd;
        }
        th {
            background: #667eea;
            color: white;
        }
        tr:nth-child(even) {
            background: #f8f9fa;
        }
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            color: #e83e8c;
        }
        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: bold;
            margin: 0 5px;
        }
        .badge-success { background: #28a745; color: white; }
        .badge-info { background: #17a2b8; color: white; }
        .badge-warning { background: #ffc107; color: black; }
        .badge-danger { background: #dc3545; color: white; }
        .summary-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin: 40px 0;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }
        .summary-box h2 {
            color: white;
            border-left: 5px solid white;
        }
        .emoji {
            font-size: 1.2em;
            margin-right: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ è·³è¡¨ï¼ˆSkip Listï¼‰æ ¸å¿ƒæµç¨‹å›¾</h1>

        <div class="toc">
            <h3>ğŸ“š ç›®å½•</h3>
            <ul>
                <li><a href="#structure">1. è·³è¡¨ç»“æ„ç¤ºæ„å›¾</a></li>
                <li><a href="#insert">2. æ’å…¥æ“ä½œæµç¨‹</a></li>
                <li><a href="#delete">3. åˆ é™¤æ“ä½œæµç¨‹</a></li>
                <li><a href="#search">4. æŸ¥æ‰¾æ“ä½œæµç¨‹</a></li>
                <li><a href="#range">5. èŒƒå›´æŸ¥è¯¢æµç¨‹</a></li>
                <li><a href="#rank">6. æ’åæŸ¥è¯¢æµç¨‹</a></li>
                <li><a href="#scenarios">7. ä¸šåŠ¡åœºæ™¯åº”ç”¨</a></li>
                <li><a href="#performance">8. æ€§èƒ½å¯¹æ¯”</a></li>
                <li><a href="#summary">9. æ€»ç»“</a></li>
            </ul>
        </div>

        <h2 id="structure">1. è·³è¡¨ç»“æ„ç¤ºæ„å›¾</h2>
        <div class="structure-diagram">
<pre>
è·³è¡¨å¤šå±‚ç´¢å¼•ç»“æ„ï¼š

Level 3: head ---------------------------------> node(2500)
                |                                    |
Level 2: head --------> node(1800) -------------> node(2500)
                |           |                        |
Level 1: head --------> node(1800) -> node(2100) -> node(2500)
                |           |            |             |
Level 0: head -> node(1500) -> node(1800) -> node(1900) -> node(2100) -> node(2200) -> node(2500)

<span style="color: #28a745;">âœ… è¯´æ˜ï¼š</span>
â€¢ headï¼šå“¨å…µèŠ‚ç‚¹ï¼ˆä¸å­˜å‚¨æ•°æ®ï¼‰
â€¢ æ¯ä¸ªèŠ‚ç‚¹åŒ…å«ï¼švalueï¼ˆæ•°æ®ï¼‰ã€scoreï¼ˆåˆ†æ•°ï¼‰ã€forward[]ï¼ˆå‰å‘æŒ‡é’ˆæ•°ç»„ï¼‰
â€¢ å±‚çº§è¶Šé«˜ï¼Œè·³è·ƒçš„è·ç¦»è¶Šå¤§ï¼ŒæŸ¥æ‰¾é€Ÿåº¦è¶Šå¿«
â€¢ æœ€åº•å±‚ï¼ˆLevel 0ï¼‰åŒ…å«æ‰€æœ‰èŠ‚ç‚¹ï¼Œæ˜¯å®Œæ•´çš„æœ‰åºé“¾è¡¨
</pre>
        </div>

        <h2 id="insert">2. æ’å…¥æ“ä½œæµç¨‹</h2>
        <div class="mermaid">
flowchart TD
    Start([å¼€å§‹: insert value, score]) --> Init[åˆå§‹åŒ– update æ•°ç»„<br/>ç”¨äºè®°å½•æ¯å±‚çš„å‰é©±èŠ‚ç‚¹]
    Init --> SetCurrent[è®¾ç½® current = head<br/>ä»æœ€é«˜å±‚å¼€å§‹]

    SetCurrent --> LoopLevel{éå†æ¯ä¸€å±‚<br/>i = level-1 down to 0}

    LoopLevel -->|æ¯å±‚| SearchForward{current.forward[i] != null<br/>ä¸” score æ›´å¤§?}
    SearchForward -->|æ˜¯| MoveForward[current = current.forward[i]<br/>ç»§ç»­å‘å‰æœç´¢]
    MoveForward --> SearchForward

    SearchForward -->|å¦| RecordUpdate[update[i] = current<br/>è®°å½•è¯¥å±‚çš„å‰é©±èŠ‚ç‚¹]
    RecordUpdate --> NextLevel{è¿˜æœ‰ä¸‹ä¸€å±‚?}
    NextLevel -->|æ˜¯| LoopLevel

    NextLevel -->|å¦| RandomLevel[éšæœºç”Ÿæˆæ–°èŠ‚ç‚¹å±‚æ•°<br/>newLevel = randomLevel]

    RandomLevel --> CheckLevel{newLevel > level?}
    CheckLevel -->|æ˜¯| UpdateHead[å°†æ–°å±‚çš„ update<br/>æŒ‡å‘ head]
    CheckLevel -->|å¦| CreateNode[åˆ›å»ºæ–°èŠ‚ç‚¹<br/>newNode score, value, newLevel]
    UpdateHead --> UpdateLevel[æ›´æ–°è·³è¡¨å±‚æ•°<br/>level = newLevel]
    UpdateLevel --> CreateNode

    CreateNode --> InsertLoop{éå†æ–°èŠ‚ç‚¹çš„æ¯ä¸€å±‚<br/>i = 0 to newLevel-1}

    InsertLoop -->|æ¯å±‚| LinkNode1[newNode.forward[i] = update[i].forward[i]]
    LinkNode1 --> LinkNode2[update[i].forward[i] = newNode]
    LinkNode2 --> InsertNext{è¿˜æœ‰å±‚?}
    InsertNext -->|æ˜¯| InsertLoop
    InsertNext -->|å¦| End([æ’å…¥å®Œæˆ])

    style Start fill:#90EE90
    style End fill:#FFB6C1
    style RandomLevel fill:#FFD700
    style CreateNode fill:#87CEEB
        </div>

        <div class="explanation">
            <h3>ğŸ“ æ’å…¥æ“ä½œè¯¦ç»†æ­¥éª¤</h3>
            <ol>
                <li><strong>åˆå§‹åŒ–é˜¶æ®µ</strong>
                    <ul>
                        <li>åˆ›å»º update[MAX_LEVEL] æ•°ç»„</li>
                        <li>ç”¨äºè®°å½•æ¯å±‚éœ€è¦æ›´æ–°çš„å‰é©±èŠ‚ç‚¹</li>
                    </ul>
                </li>
                <li><strong>æŸ¥æ‰¾æ’å…¥ä½ç½®ï¼ˆä»é«˜åˆ°ä½ï¼‰</strong>
                    <ul>
                        <li>Level 3: å¿«é€Ÿè·³è·ƒï¼Œæ‰¾åˆ°å¤§è‡´åŒºåŸŸ</li>
                        <li>Level 2: ç»§ç»­ç¼©å°èŒƒå›´</li>
                        <li>Level 1: è¿›ä¸€æ­¥å®šä½</li>
                        <li>Level 0: ç²¾ç¡®å®šä½æ’å…¥ä½ç½®</li>
                    </ul>
                </li>
                <li><strong>éšæœºå±‚æ•°ç”Ÿæˆ</strong>
                    <ul>
                        <li>P = 0.25 çš„æ¦‚ç‡æ™‹å‡åˆ°ä¸‹ä¸€å±‚</li>
                        <li>æœ€å¤§å±‚æ•° = 32</li>
                        <li>æœŸæœ›å±‚æ•° = logâ‚/â‚š(N) â‰ˆ logâ‚„(N)</li>
                    </ul>
                </li>
                <li><strong>åˆ›å»ºå¹¶æ’å…¥æ–°èŠ‚ç‚¹</strong>
                    <ul>
                        <li>ä» Level 0 åˆ° Level newLevel-1</li>
                        <li>æ¯å±‚æ›´æ–°å‰é©±èŠ‚ç‚¹çš„ forward æŒ‡é’ˆ</li>
                        <li>æ–°èŠ‚ç‚¹çš„ forward æŒ‡é’ˆæŒ‡å‘åŸåç»§èŠ‚ç‚¹</li>
                    </ul>
                </li>
            </ol>
            <p><span class="badge badge-success">æ—¶é—´å¤æ‚åº¦: O(logN)</span> <span class="badge badge-info">ç©ºé—´å¤æ‚åº¦: O(1)</span></p>
        </div>

        <h2 id="delete">3. åˆ é™¤æ“ä½œæµç¨‹</h2>
        <div class="mermaid">
flowchart TD
    Start([å¼€å§‹: delete value, score]) --> Init[åˆå§‹åŒ– update æ•°ç»„]
    Init --> SetCurrent[current = head<br/>ä»æœ€é«˜å±‚å¼€å§‹]

    SetCurrent --> LoopLevel{éå†æ¯ä¸€å±‚<br/>i = level-1 down to 0}

    LoopLevel -->|æ¯å±‚| SearchForward{current.forward[i] != null<br/>ä¸” score æ›´å¤§?}
    SearchForward -->|æ˜¯| MoveForward[current = current.forward[i]]
    MoveForward --> SearchForward

    SearchForward -->|å¦| RecordUpdate[update[i] = current]
    RecordUpdate --> NextLevel{è¿˜æœ‰ä¸‹ä¸€å±‚?}
    NextLevel -->|æ˜¯| LoopLevel

    NextLevel -->|å¦| GetTarget[current = current.forward[0]<br/>è·å–ç›®æ ‡èŠ‚ç‚¹]

    GetTarget --> CheckTarget{current != null ä¸”<br/>score åŒ¹é… ä¸”<br/>value åŒ¹é…?}

    CheckTarget -->|å¦| NotFound([è¿”å› false<br/>èŠ‚ç‚¹ä¸å­˜åœ¨])

    CheckTarget -->|æ˜¯| DeleteLoop{éå†æ¯ä¸€å±‚<br/>i = 0 to level-1}

    DeleteLoop -->|æ¯å±‚| CheckUpdate{update[i].forward[i]<br/>== current?}
    CheckUpdate -->|å¦| BreakLoop[è·³å‡ºå¾ªç¯<br/>æ›´é«˜å±‚æ²¡æœ‰æ­¤èŠ‚ç‚¹]
    CheckUpdate -->|æ˜¯| UpdateLink[update[i].forward[i] = current.forward[i]<br/>åˆ é™¤æŒ‡é’ˆè¿æ¥]

    UpdateLink --> DeleteNext{è¿˜æœ‰å±‚?}
    DeleteNext -->|æ˜¯| DeleteLoop
    DeleteNext -->|å¦| AdjustLevel{æ£€æŸ¥å±‚æ•°}

    BreakLoop --> AdjustLevel

    AdjustLevel --> CheckEmpty{head.forward[level-1]<br/>== null?}
    CheckEmpty -->|æ˜¯| DecreaseLevel[level--<br/>é™ä½è·³è¡¨å±‚æ•°]
    DecreaseLevel --> CheckEmpty
    CheckEmpty -->|å¦| Success([è¿”å› true<br/>åˆ é™¤æˆåŠŸ])

    style Start fill:#90EE90
    style NotFound fill:#FFB6C1
    style Success fill:#90EE90
    style DeleteLoop fill:#FFD700
        </div>

        <div class="note">
            <h3>âš ï¸ åˆ é™¤æ“ä½œå…³é”®ç‚¹</h3>
            <ul>
                <li>å¿…é¡»ä» Level 0 åˆ°æœ€é«˜å±‚éƒ½åˆ é™¤èŠ‚ç‚¹çš„å¼•ç”¨</li>
                <li>åˆ é™¤åéœ€è¦æ£€æŸ¥å¹¶è°ƒæ•´è·³è¡¨çš„å±‚æ•°</li>
                <li>å¦‚æœæœ€é«˜å±‚ä¸ºç©ºï¼Œåˆ™å±‚æ•°å‡1</li>
                <li>æ—¶é—´å¤æ‚åº¦ï¼šO(logN)</li>
            </ul>
        </div>

        <h2 id="search">4. æŸ¥æ‰¾æ“ä½œæµç¨‹</h2>
        <div class="mermaid">
flowchart TD
    Start([å¼€å§‹: search score]) --> SetCurrent[current = head<br/>ä»æœ€é«˜å±‚å¼€å§‹]

    SetCurrent --> LoopLevel{éå†æ¯ä¸€å±‚<br/>i = level-1 down to 0}

    LoopLevel -->|æ¯å±‚| CheckForward{current.forward[i] != null<br/>ä¸” score æ›´å¤§?}

    CheckForward -->|æ˜¯| MoveForward[current = current.forward[i]<br/>å‘å‰è·³è·ƒ]
    MoveForward --> CheckForward

    CheckForward -->|å¦| NextLevel{è¿˜æœ‰ä¸‹ä¸€å±‚?}
    NextLevel -->|æ˜¯| LoopLevel

    NextLevel -->|å¦| GetNode[current = current.forward[0]<br/>ç§»åŠ¨åˆ° Level 0 çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹]

    GetNode --> CheckMatch{current != null ä¸”<br/>current.score == score?}

    CheckMatch -->|æ˜¯| Found([è¿”å› current<br/>æ‰¾åˆ°ç›®æ ‡èŠ‚ç‚¹])
    CheckMatch -->|å¦| NotFound([è¿”å› null<br/>æœªæ‰¾åˆ°])

    style Start fill:#90EE90
    style Found fill:#90EE90
    style NotFound fill:#FFB6C1
    style MoveForward fill:#87CEEB
        </div>

        <div class="structure-diagram">
<pre>
<span style="color: #667eea; font-weight: bold;">æŸ¥æ‰¾è¿‡ç¨‹ç¤ºä¾‹ï¼ˆæŸ¥æ‰¾ score = 2100ï¼‰ï¼š</span>

Level 3: head â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ node(2500)
                                                    â†“ (2500 > 2100ï¼Œåœæ­¢)
Level 2: head â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ node(1800) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ node(2500)
                            â†“ (ç»§ç»­å‘ä¸‹)
Level 1: head â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ node(1800) â†’ node(2100)
                                         â†“ (æ‰¾åˆ°ï¼)
Level 0: head â†’ node(1500) â†’ node(1800) â†’ node(1900) â†’ <span style="color: #28a745; font-weight: bold;">node(2100) âœ“</span>

<span style="color: #28a745;">å…³é”®ç‚¹ï¼š</span>
1. ä»é«˜å±‚å¼€å§‹ï¼Œå¿«é€Ÿè·³è¿‡å°äºç›®æ ‡çš„èŠ‚ç‚¹
2. é‡åˆ°å¤§äºç­‰äºç›®æ ‡çš„èŠ‚ç‚¹ï¼Œè½¬åˆ°ä¸‹ä¸€å±‚
3. é‡å¤è¿‡ç¨‹ç›´åˆ° Level 0
4. åœ¨ Level 0 éªŒè¯æ˜¯å¦ç²¾ç¡®åŒ¹é…
</pre>
        </div>

        <h2 id="range">5. èŒƒå›´æŸ¥è¯¢æµç¨‹</h2>
        <div class="mermaid">
flowchart TD
    Start([å¼€å§‹: rangeByScore<br/>minScore, maxScore]) --> InitList[åˆ›å»ºç»“æœåˆ—è¡¨<br/>result = new ArrayList]

    InitList --> SetCurrent[current = head<br/>ä»æœ€é«˜å±‚å¼€å§‹]

    SetCurrent --> FindStart{æŸ¥æ‰¾ç¬¬ä¸€ä¸ª >= minScore çš„èŠ‚ç‚¹}

    FindStart --> LoopLevel{éå†æ¯ä¸€å±‚<br/>i = level-1 down to 0}

    LoopLevel -->|æ¯å±‚| CheckForward{current.forward[i] != null<br/>ä¸” score < minScore?}

    CheckForward -->|æ˜¯| MoveForward[current = current.forward[i]<br/>ç»§ç»­å‘å‰]
    MoveForward --> CheckForward

    CheckForward -->|å¦| NextLevel{è¿˜æœ‰ä¸‹ä¸€å±‚?}
    NextLevel -->|æ˜¯| LoopLevel

    NextLevel -->|å¦| MoveToStart[current = current.forward[0]<br/>ç§»åˆ° Level 0 çš„èµ·å§‹èŠ‚ç‚¹]

    MoveToStart --> CollectLoop{current != null ä¸”<br/>score <= maxScore?}

    CollectLoop -->|æ˜¯| AddToResult[result.add current<br/>æ·»åŠ åˆ°ç»“æœåˆ—è¡¨]
    AddToResult --> MoveNext[current = current.forward[0]<br/>ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹]
    MoveNext --> CollectLoop

    CollectLoop -->|å¦| Return([è¿”å› result<br/>è¿”å›ç»“æœåˆ—è¡¨])

    style Start fill:#90EE90
    style Return fill:#90EE90
    style FindStart fill:#FFD700
    style CollectLoop fill:#87CEEB
        </div>

        <div class="tip">
            <h3>ğŸ’¡ èŒƒå›´æŸ¥è¯¢æ€§èƒ½ä¼˜åŠ¿</h3>
            <p><strong>æ—¶é—´å¤æ‚åº¦ï¼šO(logN + M)</strong></p>
            <ul>
                <li>å®šä½èµ·å§‹ç‚¹ï¼šO(logN) - åˆ©ç”¨è·³è¡¨å¿«é€Ÿå®šä½</li>
                <li>æ”¶é›†ç»“æœï¼šO(M) - Mä¸ºç»“æœæ•°é‡ï¼Œé¡ºåºéå†</li>
            </ul>
            <p><strong>åº”ç”¨åœºæ™¯ï¼š</strong></p>
            <ul>
                <li><span class="emoji">ğŸ®</span> æ¸¸æˆæ’è¡Œæ¦œï¼šæŸ¥è¯¢åˆ†æ•°åœ¨ 1000-2000 çš„ç©å®¶</li>
                <li><span class="emoji">â°</span> å»¶è¿Ÿä»»åŠ¡ï¼šè·å–å½“å‰æ—¶é—´å‰çš„æ‰€æœ‰ä»»åŠ¡</li>
                <li><span class="emoji">ğŸ’°</span> ä»·æ ¼åŒºé—´ï¼šæŸ¥è¯¢ä»·æ ¼åœ¨ 50-100 çš„å•†å“</li>
            </ul>
        </div>

        <h2 id="rank">6. æ’åæŸ¥è¯¢æµç¨‹</h2>
        <div class="mermaid">
flowchart TD
    Start([å¼€å§‹: getRank score]) --> Init[åˆå§‹åŒ–<br/>current = head<br/>rank = 0]

    Init --> LoopLevel{éå†æ¯ä¸€å±‚<br/>i = level-1 down to 0}

    LoopLevel -->|æ¯å±‚| CheckForward{current.forward[i] != null<br/>ä¸” score æ›´å¤§?}

    CheckForward -->|æ˜¯| CountNodes[ç»Ÿè®¡è·¨è¶Šçš„èŠ‚ç‚¹æ•°<br/>ä» current åˆ° current.forward[i]]

    CountNodes --> TempLoop[temp = current]
    TempLoop --> CountCheck{temp.forward[0]<br/>!= current.forward[i]?}
    CountCheck -->|æ˜¯| IncrRank1[rank++<br/>temp = temp.forward[0]]
    IncrRank1 --> CountCheck

    CountCheck -->|å¦| IncrRank2[rank++<br/>è®¡å…¥ forward[i] æœ¬èº«]
    IncrRank2 --> MoveForward[current = current.forward[i]]
    MoveForward --> CheckForward

    CheckForward -->|å¦| NextLevel{è¿˜æœ‰ä¸‹ä¸€å±‚?}
    NextLevel -->|æ˜¯| LoopLevel

    NextLevel -->|å¦| Return([è¿”å› rank<br/>è¿”å›æ’å])

    style Start fill:#90EE90
    style Return fill:#90EE90
    style CountNodes fill:#FFD700
    style LoopLevel fill:#87CEEB
        </div>

        <h2 id="scenarios">7. ä¸šåŠ¡åœºæ™¯åº”ç”¨æµç¨‹</h2>

        <h3>åœºæ™¯1ï¼šæ¸¸æˆæ’è¡Œæ¦œæ›´æ–°æµç¨‹</h3>
        <div class="mermaid">
flowchart TD
    Start([ç©å®¶å®Œæˆä»»åŠ¡]) --> GetOldScore[æŸ¥è¯¢ç©å®¶æ—§åˆ†æ•°]
    GetOldScore --> HasOld{å­˜åœ¨æ—§è®°å½•?}

    HasOld -->|æ˜¯| DeleteOld[åˆ é™¤æ—§åˆ†æ•°è®°å½•<br/>delete oldScore]
    HasOld -->|å¦| CalcNew[è®¡ç®—æ–°åˆ†æ•°<br/>newScore = oldScore + reward]
    DeleteOld --> CalcNew

    CalcNew --> Insert[æ’å…¥æ–°åˆ†æ•°<br/>insert playerId, newScore]
    Insert --> UpdateCache[æ›´æ–°æ’è¡Œæ¦œç¼“å­˜<br/>å¦‚ TOP 100]

    UpdateCache --> CheckRank{éœ€è¦æŸ¥è¯¢æ’å?}
    CheckRank -->|æ˜¯| GetRank[getRank newScore]
    GetRank --> Notify[é€šçŸ¥ç©å®¶<br/>æ‚¨å½“å‰æ’åç¬¬ X å]

    CheckRank -->|å¦| End([å®Œæˆ])
    Notify --> End

    style Start fill:#90EE90
    style End fill:#90EE90
    style Insert fill:#FFD700
        </div>

        <h3>åœºæ™¯2ï¼šå»¶è¿Ÿä»»åŠ¡æ‰§è¡Œæµç¨‹</h3>
        <div class="mermaid">
flowchart TD
    Start([å®šæ—¶å™¨è§¦å‘]) --> GetTime[è·å–å½“å‰æ—¶é—´<br/>now = currentTimeMillis]

    GetTime --> RangeQuery[èŒƒå›´æŸ¥è¯¢<br/>rangeByScore 0, now]

    RangeQuery --> CheckTasks{æœ‰åˆ°æœŸä»»åŠ¡?}

    CheckTasks -->|å¦| Sleep([ä¼‘çœ ç­‰å¾…])

    CheckTasks -->|æ˜¯| LoopTasks{éå†æ¯ä¸ªä»»åŠ¡}

    LoopTasks --> ExecTask[æ‰§è¡Œä»»åŠ¡<br/>task.execute]

    ExecTask --> DeleteTask[åˆ é™¤ä»»åŠ¡<br/>delete taskId, executeTime]

    DeleteTask --> NextTask{è¿˜æœ‰ä»»åŠ¡?}
    NextTask -->|æ˜¯| LoopTasks
    NextTask -->|å¦| Sleep

    Sleep --> Start

    style Start fill:#90EE90
    style ExecTask fill:#FFD700
    style RangeQuery fill:#87CEEB
        </div>

        <h2 id="performance">8. æ€§èƒ½å¯¹æ¯”</h2>
        <table>
            <thead>
                <tr>
                    <th>æ“ä½œ</th>
                    <th>è·³è¡¨</th>
                    <th>å¹³è¡¡æ ‘</th>
                    <th>é“¾è¡¨</th>
                    <th>æ•°ç»„</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>æ’å…¥</strong></td>
                    <td><span class="badge badge-success">O(logN)</span></td>
                    <td><span class="badge badge-success">O(logN)</span></td>
                    <td><span class="badge badge-danger">O(N)</span></td>
                    <td><span class="badge badge-danger">O(N)</span></td>
                </tr>
                <tr>
                    <td><strong>åˆ é™¤</strong></td>
                    <td><span class="badge badge-success">O(logN)</span></td>
                    <td><span class="badge badge-success">O(logN)</span></td>
                    <td><span class="badge badge-danger">O(N)</span></td>
                    <td><span class="badge badge-danger">O(N)</span></td>
                </tr>
                <tr>
                    <td><strong>æŸ¥æ‰¾</strong></td>
                    <td><span class="badge badge-success">O(logN)</span></td>
                    <td><span class="badge badge-success">O(logN)</span></td>
                    <td><span class="badge badge-danger">O(N)</span></td>
                    <td><span class="badge badge-success">O(logN)*</span></td>
                </tr>
                <tr>
                    <td><strong>èŒƒå›´æŸ¥è¯¢</strong></td>
                    <td><span class="badge badge-success">O(logN+M)</span></td>
                    <td><span class="badge badge-success">O(logN+M)</span></td>
                    <td><span class="badge badge-danger">O(N)</span></td>
                    <td><span class="badge badge-success">O(logN+M)*</span></td>
                </tr>
                <tr>
                    <td><strong>ç©ºé—´å¤æ‚åº¦</strong></td>
                    <td><span class="badge badge-info">O(N)</span></td>
                    <td><span class="badge badge-info">O(N)</span></td>
                    <td><span class="badge badge-info">O(N)</span></td>
                    <td><span class="badge badge-info">O(N)</span></td>
                </tr>
                <tr>
                    <td><strong>å®ç°éš¾åº¦</strong></td>
                    <td><span class="badge badge-success">ç®€å•</span></td>
                    <td><span class="badge badge-danger">å¤æ‚</span></td>
                    <td><span class="badge badge-success">ç®€å•</span></td>
                    <td><span class="badge badge-success">ç®€å•</span></td>
                </tr>
                <tr>
                    <td><strong>ç¼“å­˜å‹å¥½</strong></td>
                    <td><span class="badge badge-warning">ä¸­ç­‰</span></td>
                    <td><span class="badge badge-danger">å·®</span></td>
                    <td><span class="badge badge-success">å¥½</span></td>
                    <td><span class="badge badge-success">å¥½</span></td>
                </tr>
            </tbody>
        </table>
        <p style="font-size: 0.9em; color: #666;">* æ•°ç»„éœ€è¦æœ‰åºä¸”ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾</p>

        <h2 id="summary">9. æ€»ç»“</h2>
        <div class="summary-box">
            <h2><span class="emoji">ğŸ¯</span> è·³è¡¨æ ¸å¿ƒç‰¹ç‚¹</h2>
            <ul>
                <li><span class="emoji">âœ…</span> å®ç°ç®€å•ï¼Œæ˜“äºç†è§£å’Œç»´æŠ¤</li>
                <li><span class="emoji">âœ…</span> æ€§èƒ½ç¨³å®šï¼Œæ‰€æœ‰æ“ä½œ O(logN)</li>
                <li><span class="emoji">âœ…</span> æ”¯æŒé«˜æ•ˆçš„èŒƒå›´æŸ¥è¯¢</li>
                <li><span class="emoji">âœ…</span> å¹¶å‘å‹å¥½ï¼ˆç›¸æ¯”å¹³è¡¡æ ‘ï¼‰</li>
                <li><span class="emoji">âœ…</span> å†…å­˜å ç”¨åˆç†</li>
            </ul>

            <h3><span class="emoji">ğŸš€</span> é€‚ç”¨åœºæ™¯</h3>
            <ul>
                <li><span class="emoji">ğŸ®</span> æ’è¡Œæ¦œç³»ç»Ÿï¼ˆæ¸¸æˆç§¯åˆ†ã€é”€å”®æ’è¡Œï¼‰</li>
                <li><span class="emoji">â°</span> å»¶è¿Ÿä»»åŠ¡é˜Ÿåˆ—ï¼ˆå®šæ—¶ä»»åŠ¡è°ƒåº¦ï¼‰</li>
                <li><span class="emoji">ğŸ’°</span> å®æ—¶ç«ä»·ç³»ç»Ÿï¼ˆå¹¿å‘Šç«ä»·ï¼‰</li>
                <li><span class="emoji">ğŸ“Š</span> æœ‰åºæ•°æ®ç»´æŠ¤ï¼ˆæ—¶é—´åºåˆ—ï¼‰</li>
                <li><span class="emoji">ğŸ”</span> èŒƒå›´æŸ¥è¯¢éœ€æ±‚ï¼ˆåˆ†æ•°æ®µæŸ¥è¯¢ï¼‰</li>
            </ul>

            <h3><span class="emoji">ğŸ’¡</span> Redis é€‰æ‹©è·³è¡¨çš„åŸå› </h3>
            <ol>
                <li><strong>å®ç°ç®€å•</strong>ï¼šä»£ç å¯ç»´æŠ¤æ€§å¥½ï¼Œæ¯”AVLæ ‘ã€çº¢é»‘æ ‘ç®€å•</li>
                <li><strong>èŒƒå›´æŸ¥è¯¢ä¼˜ç§€</strong>ï¼šZRANGE å‘½ä»¤æ€§èƒ½å‡ºè‰²</li>
                <li><strong>æ”¯æŒé«˜æ•ˆæ’å</strong>ï¼šZRANK å‘½ä»¤æ—¶é—´å¤æ‚åº¦ O(logN)</li>
                <li><strong>å†…å­˜å¯æ¥å—</strong>ï¼šå¹³å‡æ¯ä¸ªå…ƒç´  1.33 ä¸ªæŒ‡é’ˆ</li>
                <li><strong>é€‚åˆæŒä¹…åŒ–</strong>ï¼šç»“æ„ç®€å•ï¼Œæ˜“äºåºåˆ—åŒ–</li>
                <li><strong>å¹¶å‘æ€§èƒ½å¥½</strong>ï¼šé”ç²’åº¦å¯ä»¥åšåˆ°å¾ˆç»†</li>
            </ol>
        </div>

        <div class="tip">
            <h3><span class="emoji">ğŸ“š</span> å­¦ä¹ å»ºè®®</h3>
            <ol>
                <li>å…ˆç†è§£è·³è¡¨çš„åŸºæœ¬ç»“æ„å’Œç´¢å¼•å±‚åŸç†</li>
                <li>æ‰‹åŠ¨æ¨¡æ‹Ÿæ’å…¥ã€åˆ é™¤ã€æŸ¥æ‰¾çš„å®Œæ•´è¿‡ç¨‹</li>
                <li>ç†è§£éšæœºå±‚æ•°ç”Ÿæˆçš„æ¦‚ç‡åˆ†æ</li>
                <li>å®è·µç¼–å†™ä»£ç ï¼Œè°ƒè¯•è§‚å¯ŸèŠ‚ç‚¹å˜åŒ–</li>
                <li>å¯¹æ¯”è·³è¡¨ä¸å…¶ä»–æ•°æ®ç»“æ„çš„ä¼˜åŠ£</li>
                <li>åˆ†æ Redis ZSet çš„æºç å®ç°</li>
            </ol>
        </div>
    </div>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });
    </script>
</body>
</html>

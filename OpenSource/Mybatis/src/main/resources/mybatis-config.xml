<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE configuration
  PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-config.dtd">

<configuration>
    <!-- 属性配置 -->
    <properties>
        <property name="dialect" value="h2"/>
    </properties>

    <!-- 设置 -->
    <settings>
        <!-- 开启驼峰命名转换 -->
        <setting name="mapUnderscoreToCamelCase" value="true"/>
        <!-- 开启延迟加载 -->
        <setting name="lazyLoadingEnabled" value="true"/>
        <!-- 关闭积极的延迟加载 -->
        <setting name="aggressiveLazyLoading" value="false"/>
        <!-- 允许多结果集 -->
        <setting name="multipleResultSetsEnabled" value="true"/>
        <!-- 使用列标签代替列名 -->
        <setting name="useColumnLabel" value="true"/>
        <!-- 允许JDBC生成主键 -->
        <setting name="useGeneratedKeys" value="true"/>
        <!-- 默认执行器类型 -->
        <setting name="defaultExecutorType" value="SIMPLE"/>
        <!-- 默认语句超时时间(秒) -->
        <setting name="defaultStatementTimeout" value="25"/>
        <!-- 默认获取数据大小 -->
        <setting name="defaultFetchSize" value="100"/>
        <!-- 本地缓存机制 SESSION|STATEMENT -->
        <setting name="localCacheScope" value="SESSION"/>
        <!-- JDBC类型为空时的处理 -->
        <setting name="jdbcTypeForNull" value="OTHER"/>
        <!-- 延迟加载触发方法 -->
        <setting name="lazyLoadTriggerMethods" value="equals,clone,hashCode,toString"/>
        <!-- 开启二级缓存 -->
        <setting name="cacheEnabled" value="true"/>
        <!-- 自动映射行为 NONE|PARTIAL|FULL -->
        <setting name="autoMappingBehavior" value="PARTIAL"/>
        <!-- 自动映射未知列行为 NONE|WARNING|FAILING -->
        <setting name="autoMappingUnknownColumnBehavior" value="WARNING"/>
        <!-- 日志实现 -->
        <setting name="logImpl" value="SLF4J"/>
        <!-- 调用setter方法时，是否执行select语句 -->
        <setting name="callSettersOnNulls" value="false"/>
        <!-- 返回map时是否包含空值的列 -->
        <setting name="returnInstanceForEmptyRow" value="false"/>
        <!-- 日志前缀 -->
        <setting name="logPrefix" value="mybatis."/>
        <!-- 配置工厂 -->
        <setting name="configurationFactory" value=""/>
    </settings>

    <!-- 类型别名 -->
    <typeAliases>
        <!-- 为实体类包设置别名 -->
        <package name="com.learning.mybatis.entity"/>
        
        <!-- 单个类别名设置示例 -->
        <typeAlias type="com.learning.mybatis.entity.User" alias="User"/>
        <typeAlias type="com.learning.mybatis.entity.Role" alias="Role"/>
        <typeAlias type="java.util.HashMap" alias="HashMap"/>
        <typeAlias type="java.util.List" alias="List"/>
    </typeAliases>

    <!-- 类型处理器 -->
    <typeHandlers>
        <!-- 自定义类型处理器示例 -->
        <!-- 
        <typeHandler handler="com.learning.mybatis.handler.JsonTypeHandler" 
                     javaType="com.learning.mybatis.entity.JsonObject" 
                     jdbcType="VARCHAR"/>
        <typeHandler handler="com.learning.mybatis.handler.EncryptTypeHandler" 
                     javaType="java.lang.String" 
                     jdbcType="VARCHAR"/>
        -->
        
        <!-- 枚举类型处理器 -->
        <typeHandler handler="org.apache.ibatis.type.EnumOrdinalTypeHandler" 
                     javaType="com.learning.mybatis.entity.User$Gender"/>
        <typeHandler handler="org.apache.ibatis.type.EnumOrdinalTypeHandler" 
                     javaType="com.learning.mybatis.entity.User$Status"/>
    </typeHandlers>

    <!-- 对象工厂 -->
    <objectFactory type="org.apache.ibatis.reflection.factory.DefaultObjectFactory">
        <!-- 对象工厂属性配置 -->
        <property name="someProperty" value="100"/>
    </objectFactory>

    <!-- 插件配置 -->
    <plugins>
        <!-- 分页插件 -->
        <plugin interceptor="com.github.pagehelper.PageInterceptor">
            <property name="helperDialect" value="h2"/>
            <property name="reasonable" value="true"/>
            <property name="supportMethodsArguments" value="true"/>
            <property name="params" value="count=countSql"/>
            <property name="autoRuntimeDialect" value="true"/>
        </plugin>
        
        <!-- 性能监控插件示例 -->
        <!-- 
        <plugin interceptor="com.learning.mybatis.plugin.PerformanceInterceptor">
            <property name="maxTime" value="1000"/>
            <property name="format" value="true"/>
        </plugin>
        -->
        
        <!-- SQL打印插件示例 -->
        <!-- 
        <plugin interceptor="com.learning.mybatis.plugin.SqlPrintInterceptor">
            <property name="dialect" value="h2"/>
        </plugin>
        -->
    </plugins>

    <!-- 环境配置 -->
    <environments default="development">
        <environment id="development">
            <!-- 事务管理器 -->
            <transactionManager type="JDBC"/>
            <!-- 数据源 -->
            <dataSource type="POOLED">
                <property name="driver" value="com.h2.Driver"/>
                <property name="url" value="jdbc:h2:mem:testdb;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MODE=MySQL"/>
                <property name="username" value="sa"/>
                <property name="password" value=""/>
                
                <!-- 连接池配置 -->
                <property name="poolMaximumActiveConnections" value="20"/>
                <property name="poolMaximumIdleConnections" value="5"/>
                <property name="poolMaximumCheckoutTime" value="20000"/>
                <property name="poolTimeToWait" value="20000"/>
                <property name="poolPingQuery" value="SELECT 1"/>
                <property name="poolPingEnabled" value="true"/>
                <property name="poolPingConnectionsNotUsedFor" value="19000"/>
            </dataSource>
        </environment>
        
        <!-- 生产环境配置示例 -->
        <environment id="production">
            <transactionManager type="MANAGED"/>
            <dataSource type="JNDI">
                <property name="data_source" value="java:comp/env/jdbc/mybatis"/>
            </dataSource>
        </environment>
    </environments>

    <!-- 数据库厂商标识 -->
    <databaseIdProvider type="DB_VENDOR">
        <property name="MySQL" value="mysql"/>
        <property name="Oracle" value="oracle"/>
        <property name="PostgreSQL" value="postgresql"/>
        <property name="H2" value="h2"/>
    </databaseIdProvider>

    <!-- 映射器配置 -->
    <mappers>
        <!-- 使用包扫描方式 -->
        <package name="com.learning.mybatis.mapper"/>
        
        <!-- 单个映射器配置示例 -->
        <!-- 
        <mapper resource="mapper/UserMapper.xml"/>
        <mapper class="com.learning.mybatis.mapper.UserMapper"/>
        <mapper url="file:///var/mappers/UserMapper.xml"/>
        -->
    </mappers>

</configuration>
# Dubbo å¿«é€Ÿå…¥é—¨æŒ‡å—

## 5 åˆ†é’Ÿä¸Šæ‰‹ Dubbo

æœ¬æŒ‡å—å°†å¸®åŠ©ä½ å¿«é€Ÿäº†è§£å’Œè¿è¡Œ Dubbo ç¤ºä¾‹ã€‚

## æ­¥éª¤ 1: ç¯å¢ƒå‡†å¤‡

### å¿…éœ€è½¯ä»¶
- JDK 8 æˆ–æ›´é«˜ç‰ˆæœ¬
- Maven 3.6+
- IDE (æ¨è IntelliJ IDEA æˆ– Eclipse)

### æ£€æŸ¥ç¯å¢ƒ
```bash
java -version
mvn -version
```

## æ­¥éª¤ 2: å¯åŠ¨æ³¨å†Œä¸­å¿ƒï¼ˆå¯é€‰ï¼‰

### æ–¹å¼ä¸€ï¼šä½¿ç”¨å†…å­˜æ³¨å†Œä¸­å¿ƒï¼ˆæ¨èåˆå­¦è€…ï¼‰

ç¤ºä¾‹ä»£ç å·²åŒ…å« SimpleRegistry å®ç°ï¼Œæ— éœ€é¢å¤–é…ç½®ã€‚

### æ–¹å¼äºŒï¼šä½¿ç”¨ Zookeeper

```bash
# Docker æ–¹å¼ï¼ˆæœ€ç®€å•ï¼‰
docker run -d --name zookeeper -p 2181:2181 zookeeper:3.8

# éªŒè¯å¯åŠ¨
telnet 127.0.0.1 2181
```

## æ­¥éª¤ 3: è¿è¡Œæ ¸å¿ƒç¤ºä¾‹

### 1. SPI æœºåˆ¶ç¤ºä¾‹

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd OpenSource/Dubbo

# è¿è¡Œ SPI ç¤ºä¾‹
mvn exec:java -Dexec.mainClass="com.architecture.core.spi.DubboSPIDemo"
```

**ä½ å°†çœ‹åˆ°**ï¼š
```
é»˜è®¤åè®®: org.apache.dubbo.rpc.protocol.dubbo.DubboProtocol
Dubbo åè®®: org.apache.dubbo.rpc.protocol.dubbo.DubboProtocol
è‡ªé€‚åº”åè®®: org.apache.dubbo.rpc.Protocol$Adaptive

æ‰€æœ‰æ”¯æŒçš„åè®®æ‰©å±•:
dubbo
injvm
...
```

### 2. è´Ÿè½½å‡è¡¡ç¤ºä¾‹

```bash
mvn exec:java -Dexec.mainClass="com.architecture.core.loadbalance.LoadBalanceDemo"
```

**ä½ å°†çœ‹åˆ°**ï¼š
```
=== éšæœºè´Ÿè½½å‡è¡¡ ===
192.168.1.1:20880 è¢«é€‰ä¸­: 167 æ¬¡
192.168.1.2:20880 è¢«é€‰ä¸­: 333 æ¬¡
192.168.1.3:20880 è¢«é€‰ä¸­: 500 æ¬¡

=== è½®è¯¢è´Ÿè½½å‡è¡¡ ===
192.168.1.1:20880 è¢«é€‰ä¸­: 167 æ¬¡
192.168.1.2:20880 è¢«é€‰ä¸­: 333 æ¬¡
192.168.1.3:20880 è¢«é€‰ä¸­: 500 æ¬¡
```

### 3. é›†ç¾¤å®¹é”™ç¤ºä¾‹

```bash
mvn exec:java -Dexec.mainClass="com.architecture.core.cluster.ClusterDemo"
```

**ä½ å°†çœ‹åˆ°**ï¼š
```
=== æµ‹è¯• Failover ç­–ç•¥ ===
å°è¯•è°ƒç”¨ [1]: 192.168.1.1:20880
è°ƒç”¨å¤±è´¥ï¼Œå‡†å¤‡é‡è¯•: è°ƒç”¨å¤±è´¥: 192.168.1.1:20880
å°è¯•è°ƒç”¨ [2]: 192.168.1.2:20880
ç»“æœ: è°ƒç”¨æˆåŠŸ: 192.168.1.2:20880 -> sayHello
```

## æ­¥éª¤ 4: è¿è¡Œä¸šåŠ¡ç¤ºä¾‹

### å®Œæ•´ä¸šåŠ¡æµç¨‹æ¼”ç¤º

```bash
mvn exec:java -Dexec.mainClass="com.architecture.business.demo.BusinessDemo"
```

**ä¸šåŠ¡æµç¨‹**ï¼š
1. ç”¨æˆ·ç™»å½•
2. æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
3. åˆ›å»ºè®¢å•
4. æŸ¥è¯¢è®¢å•è¯¦æƒ…
5. æ”¯ä»˜è®¢å•
6. æŸ¥è¯¢è®¢å•çŠ¶æ€
7. æŸ¥è¯¢ç”¨æˆ·æ‰€æœ‰è®¢å•
8. æŸ¥è¯¢æ”¯ä»˜è®°å½•
9. å¼‚å¸¸åœºæ™¯æµ‹è¯•
10. ç”¨æˆ·ç™»å‡º

**ä½ å°†çœ‹åˆ°å®Œæ•´çš„æœåŠ¡è°ƒç”¨é“¾è·¯**ï¼š
```
========== Dubbo ä¸šåŠ¡åœºæ™¯æ¼”ç¤º ==========

ã€åœºæ™¯1ã€‘ç”¨æˆ·ç™»å½•
----------------------------------------
[UserService] ç”¨æˆ·ç™»å½•: username=alice
[UserService] ç™»å½•æˆåŠŸ: token=TOKEN_1_1705401234567
ç™»å½•æˆåŠŸï¼ŒToken: TOKEN_1_1705401234567

ã€åœºæ™¯2ã€‘æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
----------------------------------------
[UserService] æŸ¥è¯¢ç”¨æˆ·: userId=1
[UserService] æŸ¥è¯¢ç»“æœ: User{id=1, username='alice', ...}
ç”¨æˆ·ä¿¡æ¯: User{id=1, username='alice', ...}

ã€åœºæ™¯3ã€‘åˆ›å»ºè®¢å•
----------------------------------------
[OrderService] åˆ›å»ºè®¢å•: Order{userId=1, items=2}
[OrderService] éªŒè¯ç”¨æˆ·: userId=1
[UserService] æŸ¥è¯¢ç”¨æˆ·: userId=1
[OrderService] è®¢å•åˆ›å»ºæˆåŠŸ: orderId=1705401234567
è®¢å•åˆ›å»ºæˆåŠŸï¼Œè®¢å•ID: 1705401234567

...
```

## æ­¥éª¤ 5: ç†è§£é…ç½®æ–¹å¼

### XML é…ç½®ç¤ºä¾‹

æŸ¥çœ‹æ–‡ä»¶ï¼š`src/main/resources/dubbo-provider.xml`

```xml
<!-- æœåŠ¡æä¾›è€… -->
<dubbo:application name="dubbo-provider-demo"/>
<dubbo:registry address="zookeeper://127.0.0.1:2181"/>
<dubbo:protocol name="dubbo" port="20880"/>

<bean id="userService" class="com.architecture.business.user.UserServiceImpl"/>

<dubbo:service interface="com.architecture.business.user.UserService"
               ref="userService"
               version="1.0.0"/>
```

### æ³¨è§£é…ç½®ç¤ºä¾‹

æŸ¥çœ‹æ–‡ä»¶ï¼š`src/main/java/com/architecture/config/AnnotationConfig.java`

```java
// æœåŠ¡æä¾›è€…
@DubboService(version = "1.0.0", timeout = 3000)
public class UserServiceImpl implements UserService {
    // ...
}

// æœåŠ¡æ¶ˆè´¹è€…
@DubboReference(version = "1.0.0", timeout = 3000)
private UserService userService;
```

### API é…ç½®ç¤ºä¾‹

æŸ¥çœ‹æ–‡ä»¶ï¼š`src/main/java/com/architecture/config/ApiConfig.java`

```java
// åˆ›å»ºæœåŠ¡é…ç½®
ServiceConfig<UserService> service = new ServiceConfig<>();
service.setInterface(UserService.class);
service.setRef(new UserServiceImpl());

// å¯åŠ¨æœåŠ¡
DubboBootstrap.getInstance()
    .application(application)
    .registry(registry)
    .service(service)
    .start();
```

## æ­¥éª¤ 6: æ·±å…¥å­¦ä¹ 

### å­¦ä¹ æ–‡æ¡£
1. ğŸ“š [æ ¸å¿ƒåŸç†](æ ¸å¿ƒåŸç†.md) - æ·±å…¥ç†è§£ Dubbo æ¶æ„å’ŒåŸç†
2. ğŸ”§ [å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ](å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ.md) - æ’æŸ¥å’Œè§£å†³å®é™…é—®é¢˜
3. ğŸ’¼ [é¢è¯•é¢˜æ±‡æ€»](é¢è¯•é¢˜æ±‡æ€».md) - å‡†å¤‡æŠ€æœ¯é¢è¯•

### æ ¸å¿ƒæ¦‚å¿µ

#### 1. æœåŠ¡æä¾›è€… (Provider)
æš´éœ²æœåŠ¡ä¾›å…¶ä»–åº”ç”¨è°ƒç”¨ã€‚

#### 2. æœåŠ¡æ¶ˆè´¹è€… (Consumer)
è°ƒç”¨è¿œç¨‹æœåŠ¡çš„åº”ç”¨ã€‚

#### 3. æ³¨å†Œä¸­å¿ƒ (Registry)
æœåŠ¡æ³¨å†Œä¸å‘ç°çš„ä¸­å¿ƒèŠ‚ç‚¹ã€‚

#### 4. ç›‘æ§ä¸­å¿ƒ (Monitor)
ç»Ÿè®¡æœåŠ¡è°ƒç”¨æ¬¡æ•°å’Œæ—¶é—´ã€‚

### è°ƒç”¨æµç¨‹

```
1. Provider å¯åŠ¨ï¼Œå‘ Registry æ³¨å†ŒæœåŠ¡
   â†“
2. Consumer å¯åŠ¨ï¼Œå‘ Registry è®¢é˜…æœåŠ¡
   â†“
3. Registry è¿”å› Provider åœ°å€åˆ—è¡¨
   â†“
4. Consumer åŸºäºè´Ÿè½½å‡è¡¡ç®—æ³•é€‰æ‹© Provider
   â†“
5. Consumer è°ƒç”¨ Provider
   â†“
6. Consumer å’Œ Provider å®šæœŸå‘ Monitor å‘é€ç»Ÿè®¡
```

## å¸¸ç”¨é…ç½®è¯´æ˜

### è¶…æ—¶é…ç½®
```xml
<!-- å…¨å±€è¶…æ—¶ -->
<dubbo:consumer timeout="3000"/>

<!-- æ¥å£çº§è¶…æ—¶ -->
<dubbo:reference interface="UserService" timeout="5000"/>

<!-- æ–¹æ³•çº§è¶…æ—¶ -->
<dubbo:method name="createUser" timeout="10000"/>
```

**ä¼˜å…ˆçº§**ï¼šæ–¹æ³•çº§ > æ¥å£çº§ > å…¨å±€

### é‡è¯•é…ç½®
```xml
<!-- è¯»æ“ä½œå¯ä»¥é‡è¯• -->
<dubbo:reference interface="UserService" retries="2"/>

<!-- å†™æ“ä½œç¦ç”¨é‡è¯• -->
<dubbo:method name="createUser" retries="0"/>
```

### è´Ÿè½½å‡è¡¡é…ç½®
```xml
<dubbo:reference interface="UserService" loadbalance="roundrobin"/>
```

å¯é€‰å€¼ï¼š
- `random`: éšæœºï¼ˆé»˜è®¤ï¼‰
- `roundrobin`: è½®è¯¢
- `leastactive`: æœ€å°‘æ´»è·ƒè°ƒç”¨æ•°
- `consistenthash`: ä¸€è‡´æ€§å“ˆå¸Œ

### é›†ç¾¤å®¹é”™é…ç½®
```xml
<dubbo:reference interface="UserService" cluster="failfast"/>
```

å¯é€‰å€¼ï¼š
- `failover`: å¤±è´¥è‡ªåŠ¨åˆ‡æ¢ï¼ˆé»˜è®¤ï¼‰
- `failfast`: å¿«é€Ÿå¤±è´¥
- `failsafe`: å¤±è´¥å®‰å…¨
- `failback`: å¤±è´¥è‡ªåŠ¨æ¢å¤
- `forking`: å¹¶è¡Œè°ƒç”¨
- `broadcast`: å¹¿æ’­è°ƒç”¨

## ä¸‹ä¸€æ­¥

### åˆå­¦è€…
1. âœ… è¿è¡Œæ‰€æœ‰ç¤ºä¾‹ä»£ç 
2. âœ… ç†è§£ä¸‰ç§é…ç½®æ–¹å¼
3. âœ… å­¦ä¹ è´Ÿè½½å‡è¡¡å’Œé›†ç¾¤å®¹é”™
4. âœ… é˜…è¯»æ ¸å¿ƒåŸç†æ–‡æ¡£

### è¿›é˜¶å­¦ä¹ 
1. ğŸ“– æ·±å…¥å­¦ä¹  Dubbo æ¶æ„
2. ğŸ” ç ”ç©¶ SPI æ‰©å±•æœºåˆ¶
3. ğŸ’¡ å®ç°è‡ªå®šä¹‰æ‰©å±•
4. ğŸš€ æ€§èƒ½ä¼˜åŒ–å’Œè°ƒä¼˜

### å®æˆ˜é¡¹ç›®
1. æ­å»ºå¾®æœåŠ¡æ¶æ„
2. å®ç°æœåŠ¡æ²»ç†
3. é›†æˆç›‘æ§å’Œé“¾è·¯è¿½è¸ª
4. ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

## è·å–å¸®åŠ©

### é‡åˆ°é—®é¢˜ï¼Ÿ
1. æŸ¥çœ‹ [å¸¸è§é—®é¢˜æ–‡æ¡£](å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ.md)
2. æŸ¥çœ‹ [Dubbo å®˜æ–¹æ–‡æ¡£](https://dubbo.apache.org/zh/docs/)
3. æäº¤ [GitHub Issues](https://github.com/apache/dubbo/issues)

### ç¤¾åŒºèµ„æº
- [Dubbo å®˜ç½‘](https://dubbo.apache.org/)
- [GitHub ä»“åº“](https://github.com/apache/dubbo)
- [ç¤¾åŒºè®¨è®ºåŒº](https://github.com/apache/dubbo/discussions)

## æ€»ç»“

é€šè¿‡æœ¬å¿«é€Ÿå…¥é—¨æŒ‡å—ï¼Œä½ å·²ç»ï¼š

âœ… äº†è§£äº† Dubbo çš„åŸºæœ¬æ¦‚å¿µ
âœ… è¿è¡Œäº†æ ¸å¿ƒåŠŸèƒ½ç¤ºä¾‹
âœ… æŒæ¡äº†ä¸‰ç§é…ç½®æ–¹å¼
âœ… ç†è§£äº†è´Ÿè½½å‡è¡¡å’Œé›†ç¾¤å®¹é”™
âœ… çŸ¥é“äº†å¦‚ä½•è¿›ä¸€æ­¥å­¦ä¹ 

ç»§ç»­æ¢ç´¢ Dubbo çš„å¼ºå¤§åŠŸèƒ½ï¼Œç¥ä½ å­¦ä¹ æ„‰å¿«ï¼ğŸš€
